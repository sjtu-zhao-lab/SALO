circuit PE :
  module PE :
    input clock : Clock
    input reset : UInt<1>
    input io_in_q : SInt<9>
    input io_in_sum : SInt<18>
    input io_in_sum_exp : SInt<5>
    input io_in_kv : SInt<9>
    input io_in_inv_sum_exp : SInt<5>
    input io_in_inv_sum : SInt<9>
    input io_in_stage : UInt<3>
    output io_out_q : SInt<9>
    output io_out_sum : SInt<18>
    output io_out_sum_exp : SInt<5>
    output io_out_kv : SInt<9>
    output io_out_stage : UInt<3>
    output io_out_acc : SInt<18>

    reg q : SInt<9>, clock with :
      reset => (UInt<1>("h0"), q) @[PE.scala 49:16]
    reg kv : SInt<9>, clock with :
      reset => (UInt<1>("h0"), kv) @[PE.scala 50:17]
    reg sum : SInt<18>, clock with :
      reset => (UInt<1>("h0"), sum) @[PE.scala 51:18]
    reg sum_exp : SInt<5>, clock with :
      reset => (UInt<1>("h0"), sum_exp) @[PE.scala 52:22]
    reg stage : UInt<3>, clock with :
      reset => (UInt<1>("h0"), stage) @[PE.scala 53:20]
    reg reg_acc : SInt<18>, clock with :
      reset => (UInt<1>("h0"), reg_acc) @[PE.scala 65:22]
    reg reg_prob : SInt<18>, clock with :
      reset => (UInt<1>("h0"), reg_prob) @[PE.scala 68:23]
    reg reg_max_exp : SInt<5>, clock with :
      reset => (UInt<1>("h0"), reg_max_exp) @[PE.scala 73:26]
    reg lut_k_0 : SInt<9>, clock with :
      reset => (UInt<1>("h0"), lut_k_0) @[PE.scala 80:24]
    reg lut_k_1 : SInt<9>, clock with :
      reset => (UInt<1>("h0"), lut_k_1) @[PE.scala 80:24]
    reg lut_k_2 : SInt<9>, clock with :
      reset => (UInt<1>("h0"), lut_k_2) @[PE.scala 80:24]
    reg lut_k_3 : SInt<9>, clock with :
      reset => (UInt<1>("h0"), lut_k_3) @[PE.scala 80:24]
    reg lut_b_0 : SInt<18>, clock with :
      reset => (UInt<1>("h0"), lut_b_0) @[PE.scala 81:24]
    reg lut_b_1 : SInt<18>, clock with :
      reset => (UInt<1>("h0"), lut_b_1) @[PE.scala 81:24]
    reg lut_b_2 : SInt<18>, clock with :
      reset => (UInt<1>("h0"), lut_b_2) @[PE.scala 81:24]
    reg lut_b_3 : SInt<18>, clock with :
      reset => (UInt<1>("h0"), lut_b_3) @[PE.scala 81:24]
    node _integer_bits_T = bits(reg_acc, 15, 11) @[PE.scala 86:28]
    node _integer_bits_T_1 = asSInt(_integer_bits_T) @[PE.scala 86:43]
    node _fraction_bits_T = bits(reg_acc, 10, 3) @[PE.scala 87:29]
    node _fraction_bits_T_1 = cvt(_fraction_bits_T) @[PE.scala 87:41]
    node _fraction_bits_T_2 = asSInt(_fraction_bits_T_1) @[PE.scala 87:56]
    node fraction_bits = _fraction_bits_T_2 @[PE.scala 70:29 PE.scala 87:19]
    node _k_T = bits(fraction_bits, 7, 6) @[PE.scala 88:29]
    node _GEN_0 = validif(eq(UInt<1>("h0"), _k_T), lut_k_0) @[PE.scala 88:7 PE.scala 88:7]
    node _GEN_1 = mux(eq(UInt<1>("h1"), _k_T), lut_k_1, _GEN_0) @[PE.scala 88:7 PE.scala 88:7]
    node _GEN_2 = mux(eq(UInt<2>("h2"), _k_T), lut_k_2, _GEN_1) @[PE.scala 88:7 PE.scala 88:7]
    node _GEN_3 = mux(eq(UInt<2>("h3"), _k_T), lut_k_3, _GEN_2) @[PE.scala 88:7 PE.scala 88:7]
    node _b_T = bits(fraction_bits, 7, 6) @[PE.scala 89:29]
    node _GEN_4 = validif(eq(UInt<1>("h0"), _b_T), lut_b_0) @[PE.scala 89:7 PE.scala 89:7]
    node _GEN_5 = mux(eq(UInt<1>("h1"), _b_T), lut_b_1, _GEN_4) @[PE.scala 89:7 PE.scala 89:7]
    node _GEN_6 = mux(eq(UInt<2>("h2"), _b_T), lut_b_2, _GEN_5) @[PE.scala 89:7 PE.scala 89:7]
    node _GEN_7 = mux(eq(UInt<2>("h3"), _b_T), lut_b_3, _GEN_6) @[PE.scala 89:7 PE.scala 89:7]
    node oprand1_shifted = shr(reg_acc, 4) @[Arithmetic.scala 38:50]
    node _oprand1_T = bits(oprand1_shifted, 8, 0) @[Arithmetic.scala 40:24]
    node _oprand1_T_1 = asSInt(_oprand1_T) @[Arithmetic.scala 40:56]
    node _oprand1_T_2 = gt(reg_acc, shl(asSInt(UInt<13>("hff0")), 4)) @[Arithmetic.scala 47:56]
    node _oprand1_T_3 = lt(reg_acc, shl(asSInt(UInt<13>("h1000")), 4)) @[Arithmetic.scala 47:83]
    node _oprand1_T_4 = mux(_oprand1_T_3, asSInt(UInt<13>("h1000")), _oprand1_T_1) @[Mux.scala 98:16]
    node _oprand1_T_5 = mux(_oprand1_T_2, asSInt(UInt<13>("hff0")), _oprand1_T_4) @[Mux.scala 98:16]
    node _oprand1_T_6 = eq(UInt<1>("h0"), io_in_stage) @[Mux.scala 80:60]
    node _oprand1_WIRE = validif(UInt<1>("h0"), SInt<9>("h0"))
    node _oprand1_T_7 = mux(_oprand1_T_6, io_in_q, _oprand1_WIRE) @[Mux.scala 80:57]
    node _oprand1_T_8 = eq(UInt<1>("h1"), io_in_stage) @[Mux.scala 80:60]
    node _lut_k_k_T = _GEN_3 @[PE.scala 88:7]
    node k = _lut_k_k_T @[PE.scala 83:17 PE.scala 88:7]
    node _oprand1_T_9 = mux(_oprand1_T_8, k, _oprand1_T_7) @[Mux.scala 80:57]
    node _oprand1_T_10 = eq(UInt<2>("h3"), io_in_stage) @[Mux.scala 80:60]
    node _oprand1_T_11 = mux(_oprand1_T_10, _oprand1_T_5, _oprand1_T_9) @[Mux.scala 80:57]
    node _oprand1_T_12 = eq(UInt<3>("h4"), io_in_stage) @[Mux.scala 80:60]
    node _oprand1_T_13 = mux(_oprand1_T_12, reg_prob, shl(_oprand1_T_11, 4)) @[Mux.scala 80:57]
    node _oprand2_T = eq(UInt<1>("h0"), io_in_stage) @[Mux.scala 80:60]
    node _oprand2_WIRE = validif(UInt<1>("h0"), SInt<9>("h0"))
    node _oprand2_T_1 = mux(_oprand2_T, io_in_kv, _oprand2_WIRE) @[Mux.scala 80:57]
    node _oprand2_T_2 = eq(UInt<1>("h1"), io_in_stage) @[Mux.scala 80:60]
    node _oprand2_T_3 = mux(_oprand2_T_2, fraction_bits, _oprand2_T_1) @[Mux.scala 80:57]
    node _oprand2_T_4 = eq(UInt<2>("h3"), io_in_stage) @[Mux.scala 80:60]
    node _oprand2_T_5 = mux(_oprand2_T_4, io_in_inv_sum, _oprand2_T_3) @[Mux.scala 80:57]
    node _oprand2_T_6 = eq(UInt<3>("h4"), io_in_stage) @[Mux.scala 80:60]
    node _oprand2_T_7 = mux(_oprand2_T_6, io_in_kv, _oprand2_T_5) @[Mux.scala 80:57]
    node _oprand3_T = eq(UInt<1>("h0"), io_in_stage) @[Mux.scala 80:60]
    node _oprand3_WIRE = validif(UInt<1>("h0"), SInt<18>("h0"))
    node _oprand3_T_1 = mux(_oprand3_T, reg_acc, _oprand3_WIRE) @[Mux.scala 80:57]
    node _oprand3_T_2 = eq(UInt<1>("h1"), io_in_stage) @[Mux.scala 80:60]
    node _lut_b_b_T = _GEN_7 @[PE.scala 89:7]
    node b = _lut_b_b_T @[PE.scala 84:17 PE.scala 89:7]
    node _oprand3_T_3 = mux(_oprand3_T_2, b, _oprand3_T_1) @[Mux.scala 80:57]
    node _oprand3_T_4 = eq(UInt<2>("h2"), io_in_stage) @[Mux.scala 80:60]
    node _T = eq(io_in_stage, UInt<1>("h0")) @[PE.scala 113:21]
    node _T_1 = eq(io_in_stage, UInt<1>("h1")) @[PE.scala 119:27]
    node _T_2 = eq(io_in_stage, UInt<2>("h2")) @[PE.scala 125:27]
    node _T_3 = lt(reg_max_exp, io_in_sum_exp) @[PE.scala 126:26]
    node _shifted_sum_T = sub(reg_max_exp, io_in_sum_exp) @[PE.scala 132:54]
    node _shifted_sum_T_1 = tail(_shifted_sum_T, 1) @[PE.scala 132:54]
    node _shifted_sum_T_2 = asSInt(_shifted_sum_T_1) @[PE.scala 132:54]
    node _shifted_sum_T_3 = asUInt(_shifted_sum_T_2) @[PE.scala 132:77]
    node _shifted_sum_T_4 = dshr(io_in_sum, _shifted_sum_T_3) @[PE.scala 132:38]
    node _GEN_9 = mux(_T_3, io_in_sum, _shifted_sum_T_4) @[PE.scala 126:43 PE.scala 128:25 PE.scala 132:25]
    node _GEN_22 = validif(_T_2, _GEN_9) @[PE.scala 125:35]
    node _GEN_35 = validif(eq(_T_1, UInt<1>("h0")), _GEN_22) @[PE.scala 119:35]
    node _GEN_43 = validif(eq(_T, UInt<1>("h0")), _GEN_35) @[PE.scala 113:29]
    node shifted_sum = _GEN_43 @[PE.scala 76:27]
    node _oprand3_T_5 = mux(_oprand3_T_4, shifted_sum, _oprand3_T_3) @[Mux.scala 80:57]
    node _oprand3_T_6 = eq(UInt<2>("h3"), io_in_stage) @[Mux.scala 80:60]
    node _oprand3_T_7 = mux(_oprand3_T_6, asSInt(UInt<18>("h0")), _oprand3_T_5) @[Mux.scala 80:57]
    node _oprand3_T_8 = eq(UInt<3>("h4"), io_in_stage) @[Mux.scala 80:60]
    node _oprand3_T_9 = mux(_oprand3_T_8, io_in_sum, _oprand3_T_7) @[Mux.scala 80:57]
    node _product_T = eq(io_in_stage, UInt<2>("h2")) @[PE.scala 105:31]
    node oprand1 = asSInt(bits(shr(_oprand1_T_13, 4), 8, 0)) @[PE.scala 94:23 PE.scala 101:13]
    node oprand2 = _oprand2_T_7 @[PE.scala 95:23 PE.scala 102:13]
    node _product_T_1 = mul(oprand1, oprand2) @[PE.scala 105:60]
    node _shifted_acc_T = sub(io_in_sum_exp, reg_max_exp) @[PE.scala 127:54]
    node _shifted_acc_T_1 = tail(_shifted_acc_T, 1) @[PE.scala 127:54]
    node _shifted_acc_T_2 = asSInt(_shifted_acc_T_1) @[PE.scala 127:54]
    node _shifted_acc_T_3 = asUInt(_shifted_acc_T_2) @[PE.scala 127:75]
    node _shifted_acc_T_4 = dshr(reg_acc, _shifted_acc_T_3) @[PE.scala 127:36]
    node _GEN_8 = mux(_T_3, _shifted_acc_T_4, reg_acc) @[PE.scala 126:43 PE.scala 127:25 PE.scala 131:25]
    node _GEN_21 = validif(_T_2, _GEN_8) @[PE.scala 125:35]
    node _GEN_34 = validif(eq(_T_1, UInt<1>("h0")), _GEN_21) @[PE.scala 119:35]
    node _GEN_42 = validif(eq(_T, UInt<1>("h0")), _GEN_34) @[PE.scala 113:29]
    node shifted_acc = _GEN_42 @[PE.scala 75:27]
    node _product_T_2 = mux(_product_T, shifted_acc, _product_T_1) @[PE.scala 105:19]
    node _oprand4_T = eq(io_in_stage, UInt<3>("h4")) @[PE.scala 106:31]
    node product = _product_T_2 @[PE.scala 97:23 PE.scala 105:13]
    node _oprand4_T_1 = shr(product, 3) @[PE.scala 106:47]
    node _oprand4_T_2 = eq(io_in_stage, UInt<1>("h1")) @[PE.scala 106:68]
    node _oprand4_T_3 = shr(product, 4) @[PE.scala 106:84]
    node _oprand4_T_4 = mux(_oprand4_T_2, _oprand4_T_3, product) @[PE.scala 106:56]
    node _oprand4_T_5 = mux(_oprand4_T, _oprand4_T_1, _oprand4_T_4) @[PE.scala 106:19]
    node oprand3 = _oprand3_T_9 @[PE.scala 96:23 PE.scala 103:13]
    node oprand4 = _oprand4_T_5 @[PE.scala 98:23 PE.scala 106:13]
    node _result_T = add(oprand3, oprand4) @[PE.scala 107:23]
    node _result_T_1 = tail(_result_T, 1) @[PE.scala 107:23]
    node _result_T_2 = asSInt(_result_T_1) @[PE.scala 107:23]
    node _GEN_10 = mux(_T_3, io_in_sum_exp, reg_max_exp) @[PE.scala 126:43 PE.scala 129:21 PE.scala 133:21]
    node _T_4 = eq(io_in_stage, UInt<2>("h3")) @[PE.scala 140:27]
    node _reg_prob_T = sub(io_in_inv_sum_exp, reg_max_exp) @[PE.scala 142:51]
    node _reg_prob_T_1 = tail(_reg_prob_T, 1) @[PE.scala 142:51]
    node _reg_prob_T_2 = asSInt(_reg_prob_T_1) @[PE.scala 142:51]
    node _reg_prob_T_3 = asUInt(_reg_prob_T_2) @[PE.scala 142:72]
    node result = _result_T_2 @[PE.scala 99:22 PE.scala 107:12]
    node _reg_prob_T_4 = dshr(result, _reg_prob_T_3) @[PE.scala 142:29]
    node reg_prob_shifted = shr(_reg_prob_T_4, 4) @[Arithmetic.scala 38:50]
    node _reg_prob_T_5 = bits(reg_prob_shifted, 8, 0) @[Arithmetic.scala 40:24]
    node _reg_prob_T_6 = asSInt(_reg_prob_T_5) @[Arithmetic.scala 40:56]
    node _reg_prob_T_7 = gt(_reg_prob_T_4, shl(asSInt(UInt<13>("hff0")), 4)) @[Arithmetic.scala 47:56]
    node _reg_prob_T_8 = lt(_reg_prob_T_4, shl(asSInt(UInt<13>("h1000")), 4)) @[Arithmetic.scala 47:83]
    node _reg_prob_T_9 = mux(_reg_prob_T_8, asSInt(UInt<13>("h1000")), _reg_prob_T_6) @[Mux.scala 98:16]
    node _reg_prob_T_10 = mux(_reg_prob_T_7, asSInt(UInt<13>("hff0")), _reg_prob_T_9) @[Mux.scala 98:16]
    node _T_5 = eq(io_in_stage, UInt<3>("h4")) @[PE.scala 146:27]
    node _GEN_11 = validif(eq(_T_5, UInt<1>("h0")), reg_acc) @[PE.scala 146:35 PE.scala 65:22]
    node _GEN_12 = mux(_T_5, reg_prob, reg_prob) @[PE.scala 146:35 PE.scala 148:18 PE.scala 68:23]
    node _GEN_13 = validif(eq(_T_5, UInt<1>("h0")), reg_max_exp) @[PE.scala 146:35 PE.scala 73:26]
    node _GEN_14 = mux(_T_5, result, sum) @[PE.scala 146:35 PE.scala 150:13 PE.scala 51:18]
    node _GEN_15 = validif(eq(_T_5, UInt<1>("h0")), sum_exp) @[PE.scala 146:35 PE.scala 52:22]
    node _GEN_16 = mux(_T_4, reg_acc, _GEN_11) @[PE.scala 140:35 PE.scala 141:17]
    node _GEN_17 = mux(_T_4, shl(_reg_prob_T_10, 4), _GEN_12) @[PE.scala 140:35 PE.scala 142:18]
    node _GEN_18 = mux(_T_4, reg_max_exp, _GEN_13) @[PE.scala 140:35 PE.scala 143:21]
    node _GEN_19 = validif(eq(_T_4, UInt<1>("h0")), _GEN_14) @[PE.scala 140:35]
    node _GEN_20 = validif(eq(_T_4, UInt<1>("h0")), _GEN_15) @[PE.scala 140:35]
    node _GEN_23 = validif(_T_2, _GEN_10) @[PE.scala 125:35]
    node _GEN_24 = mux(_T_2, shifted_acc, _GEN_16) @[PE.scala 125:35 PE.scala 135:17]
    node _GEN_25 = validif(eq(_T_2, UInt<1>("h0")), _GEN_17) @[PE.scala 125:35]
    node _GEN_36 = validif(eq(_T_1, UInt<1>("h0")), _GEN_23) @[PE.scala 119:35]
    node _GEN_44 = validif(eq(_T, UInt<1>("h0")), _GEN_36) @[PE.scala 113:29]
    node max_exp = _GEN_44 @[PE.scala 74:23]
    node _GEN_26 = mux(_T_2, max_exp, _GEN_18) @[PE.scala 125:35 PE.scala 137:21]
    node _GEN_27 = mux(_T_2, result, _GEN_19) @[PE.scala 125:35 PE.scala 138:13]
    node _GEN_28 = mux(_T_2, max_exp, _GEN_20) @[PE.scala 125:35 PE.scala 139:17]
    node _GEN_29 = mux(_T_1, result, _GEN_24) @[PE.scala 119:35 PE.scala 120:17]
    node _GEN_30 = validif(eq(_T_1, UInt<1>("h0")), _GEN_25) @[PE.scala 119:35]
    node integer_bits = _integer_bits_T_1 @[PE.scala 71:28 PE.scala 86:18]
    node _GEN_31 = mux(_T_1, integer_bits, _GEN_26) @[PE.scala 119:35 PE.scala 122:21]
    node _GEN_32 = validif(eq(_T_1, UInt<1>("h0")), _GEN_27) @[PE.scala 119:35]
    node _GEN_33 = validif(eq(_T_1, UInt<1>("h0")), _GEN_28) @[PE.scala 119:35]
    node _GEN_37 = mux(_T, result, _GEN_29) @[PE.scala 113:29 PE.scala 114:17]
    node _GEN_38 = validif(eq(_T, UInt<1>("h0")), _GEN_30) @[PE.scala 113:29]
    node _GEN_39 = validif(eq(_T, UInt<1>("h0")), _GEN_31) @[PE.scala 113:29]
    node _GEN_40 = validif(eq(_T, UInt<1>("h0")), _GEN_32) @[PE.scala 113:29]
    node _GEN_41 = validif(eq(_T, UInt<1>("h0")), _GEN_33) @[PE.scala 113:29]
    node _lut_k_WIRE_0 = asSInt(UInt<9>("hc")) @[PE.scala 80:32 PE.scala 80:32]
    node _lut_k_WIRE_1 = asSInt(UInt<9>("he")) @[PE.scala 80:32 PE.scala 80:32]
    node _lut_k_WIRE_2 = asSInt(UInt<9>("h11")) @[PE.scala 80:32 PE.scala 80:32]
    node _lut_k_WIRE_3 = asSInt(UInt<9>("h14")) @[PE.scala 80:32 PE.scala 80:32]
    node _lut_b_WIRE_0 = asSInt(UInt<18>("hff")) @[PE.scala 81:32 PE.scala 81:32]
    node _lut_b_WIRE_1 = asSInt(UInt<18>("hf6")) @[PE.scala 81:32 PE.scala 81:32]
    node _lut_b_WIRE_2 = asSInt(UInt<18>("he1")) @[PE.scala 81:32 PE.scala 81:32]
    node _lut_b_WIRE_3 = asSInt(UInt<18>("hb9")) @[PE.scala 81:32 PE.scala 81:32]
    io_out_q <= q @[PE.scala 59:14]
    io_out_sum <= sum @[PE.scala 61:16]
    io_out_sum_exp <= sum_exp @[PE.scala 62:20]
    io_out_kv <= kv @[PE.scala 60:15]
    io_out_stage <= stage @[PE.scala 63:18]
    io_out_acc <= reg_acc @[PE.scala 66:16]
    q <= io_in_q @[PE.scala 55:7]
    kv <= io_in_kv @[PE.scala 56:8]
    sum <= _GEN_40
    sum_exp <= _GEN_41
    stage <= io_in_stage @[PE.scala 57:11]
    reg_acc <= _GEN_37
    reg_prob <= _GEN_38
    reg_max_exp <= _GEN_39
    lut_k_0 <= mux(reset, _lut_k_WIRE_0, lut_k_0) @[PE.scala 80:24 PE.scala 80:24 PE.scala 80:24]
    lut_k_1 <= mux(reset, _lut_k_WIRE_1, lut_k_1) @[PE.scala 80:24 PE.scala 80:24 PE.scala 80:24]
    lut_k_2 <= mux(reset, _lut_k_WIRE_2, lut_k_2) @[PE.scala 80:24 PE.scala 80:24 PE.scala 80:24]
    lut_k_3 <= mux(reset, _lut_k_WIRE_3, lut_k_3) @[PE.scala 80:24 PE.scala 80:24 PE.scala 80:24]
    lut_b_0 <= mux(reset, _lut_b_WIRE_0, lut_b_0) @[PE.scala 81:24 PE.scala 81:24 PE.scala 81:24]
    lut_b_1 <= mux(reset, _lut_b_WIRE_1, lut_b_1) @[PE.scala 81:24 PE.scala 81:24 PE.scala 81:24]
    lut_b_2 <= mux(reset, _lut_b_WIRE_2, lut_b_2) @[PE.scala 81:24 PE.scala 81:24 PE.scala 81:24]
    lut_b_3 <= mux(reset, _lut_b_WIRE_3, lut_b_3) @[PE.scala 81:24 PE.scala 81:24 PE.scala 81:24]
